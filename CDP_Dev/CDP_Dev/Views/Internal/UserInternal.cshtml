@model IEnumerable<CDP.Core.Internals.UserInternal>

@{
    ViewData["Title"] = "User Internal List";
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

<h2>User Internal List</h2>

<p>
    <a type="button" class="btn btn-success" asp-action="CreateUserInternal">Create New</a>
    <a type="button" class="btn btn-info" asp-action="List">Internal List</a>
</p>
<div class="row">
    <div class="col-md-4">
        <div class="form-group">
            <label class="control-label"></label>
            <select id="UserId" class="form-control" asp-items="@(new SelectList(@ViewBag.UserList,"Id", "DisplayName"))"> </select>
        </div>
    </div>
</div>
<div class="container">
    <br />
    <div style="width:90%; margin:0 auto;">
        <table id="example" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model => model.Id)</th>
                    <th>@Html.DisplayNameFor(model => model.Topic)</th>
                    <th>@Html.DisplayNameFor(model => model.TrainingMode)</th>
                    <th>@Html.DisplayNameFor(model => model.Description)</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $(document).ajaxStart(function () {
            $("#wait").css("display", "block");
        });
        $(document).ajaxError(function () {
            $("#wait").css("display", "none");
        });
        $(document).ajaxComplete(function () {
            $("#wait").css("display", "none");
        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        var Createhref = $("#Create").attr("href");
        //var UserId = getUrlVars()["UserId"];
        var UserId = localStorage.getItem("UserId");
        if (UserId != null) {
            $("#UserId").val(UserId);
            $("#Create").attr("href", Createhref + "?UserId=" + UserId);
        }
        LoadData($("#UserId").val());
        $("#UserId").change(function () {
            var Id = $("#UserId").val();
            $("#Create").attr("href", Createhref + "?UserId=" + Id);
            LoadData(Id);
            setUserIdForLink(Id);
        });

        function LoadData(Id) {
            $("#example").DataTable({
                destroy: true,
                "processing": true,
                "serverSide": false,
                "filter": true,
                "orderMulti": false,
                "order": [[ 1, "asc" ]],
                "ajax": {
                    "url": "/Internal/LoadUserInternalData/" + Id,
                    "type": "POST",
                    "datatype": "json"
                },
                "contentType": "application/json",
                "columns": [
                    { "data": "Id", "name": "Id", "autoWidth": true, "visible": false },
                    { "data": "Topic", "name": "Topic", "autoWidth": true },
                    { "data": "TrainingMode", "name": "TrainingMode", "autoWidth": true },
                    { "data": "Description", "name": "Description", "autoWidth": true },
                    {
                        "render": function (data, type, row) { return '<a class="btn btn-warning" href="/Internal/EditUserInternal/' + row.Id + '?UserId=' + $("#UserId").val() + '">Edit</a>'; }
                    },
                    {
                        "render": function (data, type, row) { return '<a class="btn btn-danger" href="/Internal/DeleteUserInternal/' + row.Id + '">Delete</a>'; }
                    },
                ]
            });
        }

        function getUrlVars() {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
    });
</script>